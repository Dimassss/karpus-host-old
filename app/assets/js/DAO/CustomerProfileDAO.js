class CustomerProfileDAO extends DAO{constructor(){super()}addCustomersToNavTable(e,t,a){var r=new CustomerTableSQL,l=new CustomerProfileOutput,s=["fullName","telephones"],o={body:[]};r.select(e,t,e=>{e.forEach(e=>{let t=[];t[t.length]={id:e.id};for(var a=0;a<s.length;a++){let r=e[s[a]];"object"==typeof r&&(r=JSON.stringify(r).slice(4,-1).split('","').join("<br>").replace(/\"/g,"")),t[t.length]=[r,1,1]}o.body[o.body.length]=t}),e[0]&&(g.Controller.CustomerProfile.customerNavTableScrollCounter=-1),l.insertData("WP_Tbl",o),a&&a()})}fillCustomerWin(e,t){var a=new CustomerProfileOutput;(new CustomerTableSQL).load([e],r=>{var l=r[0];l=null!=l?l:{fullName:"",telephones:[""],adresses:[""],email:"",notes:"",preferences:"",socialMedia:[""],activity:"",isEmpty:!0};a.insertData("WP_ID",e),a.insertData("WP_Nm",l.fullName),a.insertData("WP_Tel",l.telephones),a.insertData("WP_Adr",l.adresses),a.insertData("WP_E-m",l.email),a.insertData("WP_Nt",l.notes),a.insertData("WP_Pr",l.preferences),a.insertData("WP_SM",l.socialMedia),a.insertData("WP_Act",l.activity),g.Controller.CustomerProfile.orderNavTableScrollCounter=0,a.insertData("WO_Tbl",{body:-1}),l.isEmpty||this.addOrdersToTable(e,void 0,t)})}addOrdersToTable(e,t,a,r){e=parseInt(e);let l=(new CustomerProfileInput).takeData("WO_SF");l=""!=l?l:void 0,l&&(g.Controller.CustomerProfile.orderNavTableScrollCounter=0);let s=new OrderTableSQL,o=new CycleTableSQL,i=new CustomerProfileOutput;-1!=g.Controller.CustomerProfile.orderNavTableScrollCounter&&o.select("1=1",[],l=>{s.select((null!=t?"id = ?":"customerID = ?")+(r?"":" ORDER BY id DESC LIMIT ?, ?"),r?[t]:[null!=t?t:e,g.Controller.CustomerProfile.orderNavTableScrollCounter*g.Controller.CustomerProfile.orderNavTableCountToSelect,g.Controller.CustomerProfile.orderNavTableCountToSelect],e=>{if(e.length>0){let a;var t={body:[]};a=["cycleID","kits","products","adress","summary","billed","pays","payDates","orderNotes","socialMedia"],e.forEach(e=>{let l=[];l[l.length]={id:e.id};for(var s=0;s<a.length;s++)l[l.length]=[r(e,a[s]),1,1];t.body[t.body.length]=l}),i.insertData("WO_Tbl",t),g.Controller.CustomerProfile.orderNavTableScrollCounter++}else g.Controller.CustomerProfile.orderNavTableScrollCounter=-1;function r(e,t){switch(t){case"cycleID":let a=l.find(a=>a.id==e[t]);return a?a.name:"Not Selected";case"kits":return Object.keys(e.kits).join(", ");case"products":return Object.keys(e.kits).map(t=>t+": ["+e.kits[t].products.map(e=>e.name+": "+e.count).join(", ")+"]").join("<br>");case"pays":case"payDates":return e[t].shift(),e[t].join(", ");default:return e[t]}}a&&a()})})}fillOrderCreatingWin(e,t,a){var r=new OrderTableSQL,l=new CustomerTableSQL,s=new CycleTableSQL,o=new KitTableSQL,i=new CustomerProfileOutput;r.load([t],n=>{var c=n[0];c||(c={id:-1,telephone:[""],socialMedia:[""],adress:[""],orderNotes:"",summary:0,billed:!1,isNotThis:!1,payDates:[""],pays:[""],cycleID:-1,customerID:e}),l.load([e],e=>{let l=e[0];l?(i.insertData("AW_Opn",!0),i.insertData("AW_Nm",l.fullName),i.insertData("AW_Pr",l.preferences),i.insertData("AW_Tel",[c.telephone[0],...l.telephones.filter(e=>e!=c.telephone[0])]),i.insertData("AW_SM",[c.socialMedia[0],...l.socialMedia.filter(e=>e!=c.socialMedia[0])]),i.insertData("AW_Adr",[c.adress[0],...l.adresses.filter(e=>e!=c.adress[0])]),i.insertData("AW_ID",c.id),i.insertData("AW_ON",c.orderNotes),i.insertData("AW_Sum",c.summary),i.insertData("AW_Bill","true"==c.billed),i.insertData("AW_n_ths","true"==c.isNotThis),i.insertData("AW_an_FN","true"==c.isNotThis?c.anotherFullName:""),i.insertData("AW_an_Tel","true"==c.isNotThis?c.anotherTelephone:""),i.insertData("AW_P",c.payDates.map((e,t)=>[c.pays[t],e])),i.insertData("AW_kits",{}),-1==c.cycleID?s.select("TRUE",[],e=>{i.insertData("AW_c_id",[[-1,"Select Cycle"],...e.map(e=>[e.id,e.name])])}):s.select("TRUE",[],e=>{var t=e.find(e=>e.id==c.cycleID),r=e.filter(e=>e.id!=c.cycleID);i.insertData("AW_c_id",[[t.id,t.name],...r.map(e=>[e.id,e.name])]),o.select("cycleID = ?",[c.cycleID],e=>{(new ProductTableSQL).select("cycleID = ?",[c.cycleID],t=>{e.forEach((a,r)=>{let l={};e[r].products.forEach((e,t)=>l[e.name]=t),e[r].products=t.map(t=>{if(void 0!==l[t.name]){let a=e[r].products[l[t.name]];t.price.selected=a.price.selected,t.count=a.count}else t.price.selected=t.price["p-kt"],t.count=0;return JSON.parse(JSON.stringify(t))});var s=c.kits[a.name];if(!s)return!1;e[r].count="number"==typeof s.count?s.count:0,e[r].price="number"==typeof s.price?s.price:e[r].price;var o={};s.products.forEach((e,t)=>o[e.name]=t);let i=0,n=0;a.products.forEach((e,t)=>{void 0!==o[e.name]?(e.count=s.products[o[e.name]].count,e.price.selected=s.products[o[e.name]].price.selected,e.count>0&&(i+=e.count*e.price[e.price.selected],n+=e.weight*e.count)):(e.count=0,e.price.selected="p-kt"),a.products[t]=Object.assign({},e)}),a.pcPrice=i,a.pcWeight=n,console.log(a,i,n)});var r={};e.forEach(e=>{r[e.name]=JSON.parse(JSON.stringify(e))}),i.insertData("AW_kits",r),i.insertData("AW_SumPC",e.filter(e=>e.count>0).map(e=>e.count*(e.price?e.price:e.pcPrice)).reduce((e,t)=>e+t,0)+" uah"),a&&a()})})})):(i.insertData("O_Tbl",{body:[[{id:t}]]}),r.del([t]))})})}displayKits(e){var t=new CustomerProfileOutput;new CycleTableSQL;(new KitTableSQL).select("cycleID = ?",[e],a=>{var r={};(new ProductTableSQL).select("cycleID = ?",[e],e=>{for(var l in a){let t=a[l],s={};t.products.forEach((e,t)=>s[e.name]=t),t.products=e.map(e=>{if(void 0!==s[e.name]){let a=t.products[s[e.name]];e.price.selected=a.selected,e.count=a.count}else e.price.selected=e.price["p-kt"],e.count=0;return e}),a[l].count||(a[l].count=0),r[a[l].name]=JSON.parse(JSON.stringify(t))}t.insertData("AW_kits",r)})})}deleteCustomer(e){var t=new CustomerTableSQL,a=new CustomerProfileOutput;(new CustomerProfileInput).takeData("WP_ID")==e&&this.fillCustomerWin(-1),a.insertData("WP_Tbl_CD",e),t.del([e]),console.log(e)}deleteOrder(e){var t=new OrderTableSQL,a=new CustomerProfileOutput;t.del([e]),a.insertData("WP_Tbl_OD",e)}getCustomerFromPage(){var e=new CustomerProfileInput;return new CustomerModel({id:e.takeData("WP_ID"),fullName:e.takeData("WP_Nm"),telephones:e.takeData("WP_Tel"),adresses:e.takeData("WP_Adr"),email:e.takeData("WP_E-m"),notes:e.takeData("WP_Nt"),preferences:e.takeData("WP_Pr"),socialMedia:e.takeData("WP_SM"),activity:e.takeData("WP_Act")})}getOrderFromPage(e,t){let a=new CustomerProfileInput,r=new OrderModel({id:a.takeData("AW_ID"),cycleID:a.takeData("AW_c_id"),telephone:a.takeData("AW_Tel"),socialMedia:a.takeData("AW_SM"),adress:a.takeData("AW_Adr"),orderNotes:a.takeData("AW_ON"),summary:a.takeData("AW_Sum"),billed:a.takeData("AW_Bill"),isNotThis:a.takeData("AW_n_ths"),customerID:a.takeData("WP_ID"),anotherFullName:a.takeData("AW_an_FN"),anotherTelephone:a.takeData("AW_an_Tel"),kits:a.takeData("AW_kits")});if(t)return r.kits;let l=this.getCustomerFromPage();l.preferences=a.takeData("AW_Pr"),l.telephones.find(e=>e==r.telephone)||l.telephones.push(r.telephone[0]),l.adresses.find(e=>e==r.adress)||l.adresses.push(r.adress[0]),l.socialMedia.find(e=>e==r.socialMedia)||l.socialMedia.push(r.socialMedia[0]);const s=a.takeData("AW_P");let o=s.map(e=>e[0]),i=s.map(e=>e[1]);return r.pays=o,r.payDates=i,[r,l]}saveCustomer(e,t){let a=new CustomerTableSQL;-1==e.id&&delete e.id,a.save([e],e=>{t(e[0])})}saveOrder(e,t){let a=new OrderTableSQL;-1==e.id&&delete e.id,a.save([e],e=>{t(e[0])})}addToArray(e,t){if(!e)return!1;let a=new CustomerProfileInput,r=new CustomerProfileOutput,l=a.takeData(e);l[l.length]=JSON.parse(JSON.stringify(l[0])),l[0]=t,r.insertData(e,l)}selectTable(e){Array.from((new CustomerProfileInput).takeData("Tbl_rows")).forEach(t=>{var a=!1;Array.from(t.querySelectorAll("td")).forEach(t=>{t.innerHTML.search(e)>-1&&(a=!0)}),t.style.display=a?"table-row":"none"})}updateOrderForm(e){let t=new CustomerProfileOutput;for(var a in e)e[a].name=a;let r=Object.values(e).filter(e=>e.count>0).map(e=>[e.count*(e.price?e.price:e.pcPrice),e.name]);t.insertData("AW_SumPC",r.map(e=>e[0]).reduce((e,t)=>e+t,0)+" uah"),r.forEach(a=>{t.insertData("AW_KtPC",[e[a[1]].pcPrice,e[a[1]].pcWeight,a[1]])})}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRBTy9DdXN0b21lclByb2ZpbGVEQU8uanMiXSwibmFtZXMiOlsiQ3VzdG9tZXJQcm9maWxlREFPIiwiREFPIiwiW29iamVjdCBPYmplY3RdIiwic3VwZXIiLCJ3aGVyZSIsImRhdGEiLCJjYiIsImRiIiwiQ3VzdG9tZXJUYWJsZVNRTCIsIm91dCIsIkN1c3RvbWVyUHJvZmlsZU91dHB1dCIsImNvbHVtbnMiLCJ0YWJsZU9iamVjdCIsImJvZHkiLCJzZWxlY3QiLCJjdXN0b21lcnMiLCJmb3JFYWNoIiwiY3VzdG9tZXIiLCJyb3ciLCJsZW5ndGgiLCJpZCIsImkiLCJ2YWwiLCJKU09OIiwic3RyaW5naWZ5Iiwic2xpY2UiLCJzcGxpdCIsImpvaW4iLCJyZXBsYWNlIiwiZyIsIkNvbnRyb2xsZXIiLCJDdXN0b21lclByb2ZpbGUiLCJjdXN0b21lck5hdlRhYmxlU2Nyb2xsQ291bnRlciIsImluc2VydERhdGEiLCJjdXN0b21lcklEIiwibG9hZCIsInVuZGVmaW5lZCIsImZ1bGxOYW1lIiwidGVsZXBob25lcyIsImFkcmVzc2VzIiwiZW1haWwiLCJub3RlcyIsInByZWZlcmVuY2VzIiwic29jaWFsTWVkaWEiLCJhY3Rpdml0eSIsImlzRW1wdHkiLCJvcmRlck5hdlRhYmxlU2Nyb2xsQ291bnRlciIsInRoaXMiLCJhZGRPcmRlcnNUb1RhYmxlIiwib3JkZXJJRCIsImlzTmV3IiwicGFyc2VJbnQiLCJzIiwiQ3VzdG9tZXJQcm9maWxlSW5wdXQiLCJ0YWtlRGF0YSIsIk9yZGVyVGFibGVTUUwiLCJkYkN5Y2xlIiwiQ3ljbGVUYWJsZVNRTCIsImN5Y2xlcyIsIm9yZGVyTmF2VGFibGVDb3VudFRvU2VsZWN0Iiwib3JkZXJzIiwib3JkZXIiLCJjb252ZXJ0RmllbGQiLCJvIiwiYyIsInIiLCJmaW5kIiwiY3ljbGUiLCJuYW1lIiwiT2JqZWN0Iiwia2V5cyIsImtpdHMiLCJtYXAiLCJraXROYW1lIiwicHJvZHVjdHMiLCJwciIsImNvdW50Iiwic2hpZnQiLCJkYk9yZGVyIiwiZGJDdXN0b21lciIsImRiS2l0IiwiS2l0VGFibGVTUUwiLCJ0ZWxlcGhvbmUiLCJhZHJlc3MiLCJvcmRlck5vdGVzIiwic3VtbWFyeSIsImJpbGxlZCIsImlzTm90VGhpcyIsInBheURhdGVzIiwicGF5cyIsImN5Y2xlSUQiLCJmaWx0ZXIiLCJ0ZWwiLCJtZWRpYSIsImQiLCJzZWxlY3RlZEN5Y2xlIiwicmVzdEN5Y2xlcyIsImtpdHNGcm9tREIiLCJQcm9kdWN0VGFibGVTUUwiLCJraXQiLCJpZE1hcCIsImtQciIsInByaWNlIiwic2VsZWN0ZWQiLCJwYXJzZSIsIm9yZGVyS2l0IiwibmFtZXMiLCJwY1ByaWNlIiwicGNXZWlnaHQiLCJ3ZWlnaHQiLCJhc3NpZ24iLCJjb25zb2xlIiwibG9nIiwia2l0c0RhdGEiLCJyZWR1Y2UiLCJhIiwiYiIsImRlbCIsImsiLCJmaWxsQ3VzdG9tZXJXaW4iLCJpbnAiLCJDdXN0b21lck1vZGVsIiwicmV0dXJuT25seUtpdHMiLCJPcmRlck1vZGVsIiwiYW5vdGhlckZ1bGxOYW1lIiwiYW5vdGhlclRlbGVwaG9uZSIsImdldEN1c3RvbWVyRnJvbVBhZ2UiLCJ0IiwicHVzaCIsInBheURhdGEiLCJkYXRlcyIsInNhdmUiLCJpbnBOYW1lIiwiZW1wIiwidmFscyIsInNlYXJjaCIsIkFycmF5IiwiZnJvbSIsInRyIiwiaGFzU2VhcmNoZWQiLCJxdWVyeVNlbGVjdG9yQWxsIiwidGQiLCJpbm5lckhUTUwiLCJzdHlsZSIsImRpc3BsYXkiLCJ2YWx1ZXMiLCJlIl0sIm1hcHBpbmdzIjoiQUE0Q0EsTUFBTUEsMkJBQTJCQyxJQUMvQkMsY0FDRUMsUUFHRkQsdUJBQXVCRSxFQUFPQyxFQUFNQyxHQUNsQyxJQUFJQyxFQUFLLElBQUlDLGlCQUNUQyxFQUFNLElBQUlDLHNCQUNWQyxFQUFVLENBQUMsV0FBWSxjQUN2QkMsRUFBYyxDQUFDQyxLQUFLLElBRXhCTixFQUFHTyxPQUFPVixFQUFPQyxFQUFNVSxJQUVyQkEsRUFBVUMsUUFBUUMsSUFDaEIsSUFBSUMsRUFB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dXN0b21lclByb2ZpbGVEQU8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuQGNsYXNzIEN1c3RvbWVyUHJvZmlsZURBT1xyXG5AZGVzYyBnaXZlIG1ldGhvZCB0byBlYXN5IG1vZGVyYXRlIHBhZ2UgYW5kIGRhdGEgb24gdGhpcyBwYWdlXHJcblxyXG5AbWV0aG9kc1xyXG4gIEBtZXRob2QgYWRkQ3VzdG9tZXJzVG9OYXZUYWJsZVxyXG4gICAgQHBhcmFtIHtTdHJpbmd9IHdoZXJlXHJcbiAgICBAcGFyYW0ge09iamVjdH0gZGF0YVxyXG4gICAgQGRvIGFkZCBuZXcgY3VzdG9tZXJzIGFzIDx0cj4gdG8gbmF2IHRhYmxlIG9mIGN1c3RvbWVyc1xyXG4gIEBtZXRob2QgZmlsbEN1c3RvbWVyV2luXHJcbiAgICBAcGFyYW0ge0ludGFnZXJ9IGN1c3RvbWVySURcclxuICAgIEBkbyBnZXQgY3VzdG9tZXIgZnJvbSBkYiBhbmQgZmlsbCBhbGwgZmllbGRzIGluIGN1c3RvbWVyIHdpbmRvd3MgYW5kIGdlbmVyYXRlIHRhYmxlIG9mIGhpcyBvcmRlcnNcclxuICBAbWV0aG9kIGZpbGxPcmRlckNyZWF0aW5nV2luXHJcbiAgICBAcGFyYW0ge0ludGFnZXJ9IGN1c3RvbWVySURcclxuICAgIEBwYXJhbSB7SW50YWdlcn0gb3JkZXJJRFxyXG4gICAgQGRvIGdldCBjdXN0b21lciBhbmQgb3JkZXIgZnJvbSBkYiBhbmQgdGhlbiBmaWxsIGFsbCBuZWVkZWQgZmllbGRzIGluIG9yZGVyIGNyZWF0aW5nIHdpbmRvd1xyXG4gIEBtZXRob2QgZGlzcGxheUtpdHNcclxuICAgIEBwYXJhbSB7SW50YWdlcn0gY3ljbGVJRFxyXG4gICAgQGRvIGRpc3BsYXkgYWxsIGtpdHMgb2Ygc2VsZWN0ZWQgY3ljbGUgaW4gb3JkZXIgY3JlYXRpbmcgd2luZG93XHJcbiAgQG1ldGhvZCBkZWxldGVDdXN0b21lclxyXG4gICAgQHBhcmFtIHtJbnRhZ2VyfSBjdXN0b21lcklEXHJcbiAgICBAZG8gZGVsZXRlIGN1c3RvbWVyIGZyb20gZGIgYW5kIGZyb20gbmF2IHRhYmxlIG9mIGN1c3RvbWVyc1xyXG4gIEBtZXRob2QgZGVsZXRlT3JkZXJcclxuICAgIEBwYXJhbSB7SW50YWdlcn0gb3JkZXJJRFxyXG4gICAgQGRvIGRlbGV0ZSBvcmRlciBmcm9tIGRiIGFuZCBmcm9tIG5hdiB0YWJsZSBvZiBjdXN0b21lcidzIG9yZGVyc1xyXG4gIEBtZXRob2QgZ2V0Q3VzdG9tZXJGcm9tUGFnZVxyXG4gICAgQHJldHVybiB7Q3VzdG9tZXJ9IGN1c3RvbWVyXHJcbiAgICBAZG8gcmVhZCBhbGwgbmVlZCBmaWVsZHMgYW5kIHRha2UgaXRzIHZhbHVlcyB0byB0aGUgY3VzdG9tZXIgb2JqZWN0LlxyXG4gIEBtZXRob2QgZ2V0T3JkZXJGcm9tUGFnZVxyXG4gICAgQHJldHVybiB7QXJyYXk8T3JkZXIsIEN1c3RvbWVyPn0gW29yZGVyLCBjdXN0b21lcl1cclxuICAgIEBkbyByZWFkIGFsbCBuZWVkIGZpZWxkcyBhbmQgdGFrZSBpdHMgdmFsdWVzIHRvIHRoZSBvcmRlciBvYmplY3QgYW5kIHJldHVybnMgdXBkYXRlZCBjdXN0b21lciBvYmplY3RlZC5cclxuICBAbWV0aG9kIHNhdmVDdXN0b21lclxyXG4gICAgQHBhcmFtIHtDdXN0b21lcn0gY3VzdG9tZXJcclxuICAgIEByZXR1cm4ge0N1c3RvbWVyfSBjdXN0b21lclxyXG4gICAgQGRvIHRha2UgY3VzdG9tZXIgb2JqZWN0IGFuZCBzYXZlIGl0IHRvIGRiLiBJZiBpdCBpcyBuZXcgY3VzdG9tZXIgc2V0IGlkIHRvIHRoZSBvYmplY3QgYW5kIHJldHVybiBpdC4gT2JqZWN0IGlmIG5ldyBhbmQgdW5kZWZpbmVkIGlmIHVwZGF0ZWRcclxuICBAbWV0aG9kIHNhdmVPcmRlclxyXG4gICAgQHBhcmFtIHtDdXN0b21lcn0gb3JkZXJcclxuICAgIEByZXR1cm4ge0N1c3RvbWVyfSBvcmRlclxyXG4gICAgQGRvIHRha2Ugb3JkZXIgb2JqZWN0IGFuZCBzYXZlIGl0IHRvIGRiLiBJZiBpdCBpcyBuZXcgb3JkZXIgc2V0IGlkIHRvIHRoZSBvYmplY3QgYW5kIHJldHVybiBpdC4gT2JqZWN0IGlmIG5ldyBhbmQgdW5kZWZpbmVkIGlmIHVwZGF0ZWRcclxuICBAbWV0aG9kIGFkZFRvQXJyYXlcclxuICAgIEBwYXJhbSB7U3RyaW5nfSBpbnBOYW1lXHJcbiAgICBAcGFyYW0ge30gZW1wID0+IGVtcHR5IGRhdGEgZm9yIGZpZWxkcyB0byBiZSBjbGVhbmVkXHJcbiAgICBAZG8gdGFrZSBkYXRhIGZyb20gbmVlZGVkIGZpZWxkIG9yIGZpZWxkcyBhbmQgcGFzdGUgbmV3IGVsZW1lbnQgdG8gaHRtbC1hcnJheVxyXG4qL1xyXG5jbGFzcyBDdXN0b21lclByb2ZpbGVEQU8gZXh0ZW5kcyBEQU97XHJcbiAgY29uc3RydWN0b3IoKXtcclxuICAgIHN1cGVyKCk7XHJcbiAgfVxyXG5cclxuICBhZGRDdXN0b21lcnNUb05hdlRhYmxlKHdoZXJlLCBkYXRhLCBjYil7XHJcbiAgICB2YXIgZGIgPSBuZXcgQ3VzdG9tZXJUYWJsZVNRTCgpO1xyXG4gICAgdmFyIG91dCA9IG5ldyBDdXN0b21lclByb2ZpbGVPdXRwdXQoKTtcclxuICAgIHZhciBjb2x1bW5zID0gW1wiZnVsbE5hbWVcIiwgXCJ0ZWxlcGhvbmVzXCJdO1xyXG4gICAgdmFyIHRhYmxlT2JqZWN0ID0ge2JvZHk6W119O1xyXG5cclxuICAgIGRiLnNlbGVjdCh3aGVyZSwgZGF0YSwgY3VzdG9tZXJzID0+IHtcclxuXHJcbiAgICAgIGN1c3RvbWVycy5mb3JFYWNoKGN1c3RvbWVyID0+IHtcclxuICAgICAgICBsZXQgcm93ID0gW107XHJcbiAgICAgICAgcm93W3Jvdy5sZW5ndGhdID0ge2lkOiBjdXN0b21lci5pZH07XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNvbHVtbnMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgbGV0IHZhbCA9IGN1c3RvbWVyW2NvbHVtbnNbaV1dO1xyXG5cclxuICAgICAgICAgIGlmKHR5cGVvZiB2YWwgPT0gXCJvYmplY3RcIikgdmFsID0gSlNPTi5zdHJpbmdpZnkodmFsKS5zbGljZSg0LCAtMSkuc3BsaXQoXCJcXFwiLFxcXCJcIikuam9pbihcIjxicj5cIikucmVwbGFjZSgvXFxcIi9nLCBcIlwiKTtcclxuXHJcbiAgICAgICAgICByb3dbcm93Lmxlbmd0aF0gPSBbdmFsLCAxLCAxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFibGVPYmplY3QuYm9keVt0YWJsZU9iamVjdC5ib2R5Lmxlbmd0aF0gPSByb3c7XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZihjdXN0b21lcnNbMF0pIGcuQ29udHJvbGxlci5DdXN0b21lclByb2ZpbGUuY3VzdG9tZXJOYXZUYWJsZVNjcm9sbENvdW50ZXIgPSAtMTtcclxuICAgICAgb3V0Lmluc2VydERhdGEoXCJXUF9UYmxcIiwgdGFibGVPYmplY3QpO1xyXG4gICAgICBpZihjYikgY2IoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmlsbEN1c3RvbWVyV2luKGN1c3RvbWVySUQsIGNiKXtcclxuICAgIHZhciBvdXQgPSBuZXcgQ3VzdG9tZXJQcm9maWxlT3V0cHV0KCk7XHJcbiAgICB2YXIgZGIgPSBuZXcgQ3VzdG9tZXJUYWJsZVNRTCgpO1xyXG4gICAgZGIubG9hZChbY3VzdG9tZXJJRF0sIGN1c3RvbWVycyA9PiB7XHJcbiAgICAgIHZhciBjdXN0b21lciA9IGN1c3RvbWVyc1swXTtcclxuICAgICAgY3VzdG9tZXIgPSBjdXN0b21lciE9dW5kZWZpbmVkP2N1c3RvbWVyOntmdWxsTmFtZTpcIlwiLCB0ZWxlcGhvbmVzOiBbXCJcIl0sIGFkcmVzc2VzOiBbXCJcIl0sIGVtYWlsOiBcIlwiLCBub3RlczogXCJcIiwgcHJlZmVyZW5jZXM6IFwiXCIsIHNvY2lhbE1lZGlhOiBbXCJcIl0sIGFjdGl2aXR5OiBcIlwiLCBpc0VtcHR5OiB0cnVlfTtcclxuICAgICAgdmFyIGNvbHVtbnMgPSBbXCJmdWxsTmFtZVwiLCBcInRlbGVwaG9uZVwiXTtcclxuXHJcbiAgICAgIG91dC5pbnNlcnREYXRhKFwiV1BfSURcIiwgY3VzdG9tZXJJRCk7XHJcbiAgICAgIG91dC5pbnNlcnREYXRhKFwiV1BfTm1cIiwgY3VzdG9tZXJbXCJmdWxsTmFtZVwiXSk7XHJcbiAgICAgIG91dC5pbnNlcnREYXRhKFwiV1BfVGVsXCIsIGN1c3RvbWVyW1widGVsZXBob25lc1wiXSk7XHJcbiAgICAgIG91dC5pbnNlcnREYXRhKFwiV1BfQWRyXCIsIGN1c3RvbWVyW1wiYWRyZXNzZXNcIl0pO1xyXG4gICAgICBvdXQuaW5zZXJ0RGF0YShcIldQX0UtbVwiLCBjdXN0b21lcltcImVtYWlsXCJdKTtcclxuICAgICAgb3V0Lmluc2VydERhdGEoXCJXUF9OdFwiLCBjdXN0b21lcltcIm5vdGVzXCJdKTtcclxuICAgICAgb3V0Lmluc2VydERhdGEoXCJXUF9QclwiLCBjdXN0b21lcltcInByZWZlcmVuY2VzXCJdKTtcclxuICAgICAgb3V0Lmluc2VydERhdGEoXCJXUF9TTVwiLCBjdXN0b21lcltcInNvY2lhbE1lZGlhXCJdKTtcclxuICAgICAgb3V0Lmluc2VydERhdGEoXCJXUF9BY3RcIiwgY3VzdG9tZXJbXCJhY3Rpdml0eVwiXSk7XHJcblxyXG4gICAgICBnLkNvbnRyb2xsZXIuQ3VzdG9tZXJQcm9maWxlLm9yZGVyTmF2VGFibGVTY3JvbGxDb3VudGVyID0gMDtcclxuXHJcbiAgICAgIG91dC5pbnNlcnREYXRhKFwiV09fVGJsXCIsIHtib2R5OiAtMX0pO1xyXG5cclxuICAgICAgaWYoIWN1c3RvbWVyLmlzRW1wdHkpIHRoaXMuYWRkT3JkZXJzVG9UYWJsZShjdXN0b21lcklELCB1bmRlZmluZWQsIGNiKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkT3JkZXJzVG9UYWJsZShjdXN0b21lcklELCBvcmRlcklELCBjYiwgaXNOZXcpe1xyXG4gICAgY3VzdG9tZXJJRCA9IHBhcnNlSW50KGN1c3RvbWVySUQpO1xyXG4gICAgbGV0IHMgPSAobmV3IEN1c3RvbWVyUHJvZmlsZUlucHV0KCkpLnRha2VEYXRhKFwiV09fU0ZcIik7XHJcbiAgICBzID0gKHMgIT0gXCJcIik/czp1bmRlZmluZWQ7XHJcbiAgICBpZihzKSBnLkNvbnRyb2xsZXIuQ3VzdG9tZXJQcm9maWxlLm9yZGVyTmF2VGFibGVTY3JvbGxDb3VudGVyID0gMDtcclxuICAgIGxldCBkYiA9IG5ldyBPcmRlclRhYmxlU1FMKCk7XHJcbiAgICBsZXQgZGJDeWNsZSA9IG5ldyBDeWNsZVRhYmxlU1FMKCk7XHJcbiAgICBsZXQgb3V0ID0gbmV3IEN1c3RvbWVyUHJvZmlsZU91dHB1dCgpO1xyXG5cclxuICAgIGlmKGcuQ29udHJvbGxlci5DdXN0b21lclByb2ZpbGUub3JkZXJOYXZUYWJsZVNjcm9sbENvdW50ZXIgIT0gLTEpIGRiQ3ljbGUuc2VsZWN0KFwiMT0xXCIsIFtdLCBjeWNsZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgZGIuc2VsZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAob3JkZXJJRCE9dW5kZWZpbmVkPydpZCA9ID8nOlwiY3VzdG9tZXJJRCA9ID9cIikgKyAoaXNOZXc/XCJcIjpcIiBPUkRFUiBCWSBpZCBERVNDIExJTUlUID8sID9cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTmV3P1tvcmRlcklEXTpbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJJRCE9dW5kZWZpbmVkP29yZGVySUQ6Y3VzdG9tZXJJRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBnLkNvbnRyb2xsZXIuQ3VzdG9tZXJQcm9maWxlLm9yZGVyTmF2VGFibGVTY3JvbGxDb3VudGVyKmcuQ29udHJvbGxlci5DdXN0b21lclByb2ZpbGUub3JkZXJOYXZUYWJsZUNvdW50VG9TZWxlY3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZy5Db250cm9sbGVyLkN1c3RvbWVyUHJvZmlsZS5vcmRlck5hdlRhYmxlQ291bnRUb1NlbGVjdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcnMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9yZGVycy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlT2JqZWN0ID0ge2JvZHk6W119O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1ucyA9IFtcImN5Y2xlSURcIiwgXCJraXRzXCIsIFwicHJvZHVjdHNcIiwgXCJhZHJlc3NcIiwgXCJzdW1tYXJ5XCIsIFwiYmlsbGVkXCIsIFwicGF5c1wiLCBcInBheURhdGVzXCIsIFwib3JkZXJOb3Rlc1wiLCBcInNvY2lhbE1lZGlhXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJzLmZvckVhY2gob3JkZXIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dbcm93Lmxlbmd0aF0gPSB7aWQ6IG9yZGVyLmlkfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykgcm93W3Jvdy5sZW5ndGhdID0gW2NvbnZlcnRGaWVsZChvcmRlciwgY29sdW1uc1tpXSksIDEsIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlT2JqZWN0LmJvZHlbdGFibGVPYmplY3QuYm9keS5sZW5ndGhdID0gcm93O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiV09fVGJsXCIsIHRhYmxlT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuQ29udHJvbGxlci5DdXN0b21lclByb2ZpbGUub3JkZXJOYXZUYWJsZVNjcm9sbENvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBnLkNvbnRyb2xsZXIuQ3VzdG9tZXJQcm9maWxlLm9yZGVyTmF2VGFibGVTY3JvbGxDb3VudGVyID0gLTE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNiKSBjYigpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjb252ZXJ0RmllbGQobywgYyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJjeWNsZUlEXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSBjeWNsZXMuZmluZChjeWNsZSA9PiBjeWNsZS5pZCA9PSBvW2NdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByP3IubmFtZTpcIk5vdCBTZWxlY3RlZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwia2l0c1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhvLmtpdHMpLmpvaW4oXCIsIFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInByb2R1Y3RzXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG8ua2l0cykubWFwKGtpdE5hbWUgPT4ga2l0TmFtZSArIFwiOiBbXCIgKyBvLmtpdHNba2l0TmFtZV0ucHJvZHVjdHMubWFwKHByID0+IHByLm5hbWUgKyBcIjogXCIgKyBwci5jb3VudCkuam9pbihcIiwgXCIpICsgXCJdXCIpLmpvaW4oXCI8YnI+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwicGF5c1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9bY10uc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb1tjXS5qb2luKFwiLCBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwYXlEYXRlc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9bY10uc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb1tjXS5qb2luKFwiLCBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaWxsT3JkZXJDcmVhdGluZ1dpbihjdXN0b21lcklELG9yZGVySUQsIGNiKXtcclxuICAgIHZhciBkYk9yZGVyID0gbmV3IE9yZGVyVGFibGVTUUwoKTtcclxuICAgIHZhciBkYkN1c3RvbWVyID0gbmV3IEN1c3RvbWVyVGFibGVTUUwoKTtcclxuICAgIHZhciBkYkN5Y2xlID0gbmV3IEN5Y2xlVGFibGVTUUwoKTtcclxuICAgIHZhciBkYktpdCA9IG5ldyBLaXRUYWJsZVNRTCgpO1xyXG4gICAgdmFyIG91dCA9IG5ldyBDdXN0b21lclByb2ZpbGVPdXRwdXQoKTtcclxuXHJcbiAgICBkYk9yZGVyLmxvYWQoW29yZGVySURdLCBvcmRlcnMgPT4ge1xyXG4gICAgICB2YXIgb3JkZXIgPSBvcmRlcnNbMF07XHJcbiAgICAgIGlmKCFvcmRlcikgb3JkZXIgPSB7aWQ6IC0xLCB0ZWxlcGhvbmU6IFtcIlwiXSwgc29jaWFsTWVkaWE6IFtcIlwiXSwgYWRyZXNzOiBbXCJcIl0sIG9yZGVyTm90ZXM6IFwiXCIsIHN1bW1hcnk6IDAsIGJpbGxlZDogZmFsc2UsIGlzTm90VGhpczogZmFsc2UsIHBheURhdGVzOiBbXCJcIl0sIHBheXM6IFtcIlwiXSwgY3ljbGVJRDogLTEsIGN1c3RvbWVySUQ6IGN1c3RvbWVySUR9O1xyXG5cclxuICAgICAgZGJDdXN0b21lci5sb2FkKFtjdXN0b21lcklEXSwgY3VzdG9tZXJzID0+IHtcclxuICAgICAgICBsZXQgY3VzdG9tZXIgPSBjdXN0b21lcnNbMF07XHJcblxyXG4gICAgICAgIGlmKCFjdXN0b21lcil7XHJcbiAgICAgICAgICBvdXQuaW5zZXJ0RGF0YShcIk9fVGJsXCIsIHtib2R5Oltbe2lkOiBvcmRlcklEfV1dfSk7XHJcbiAgICAgICAgICBkYk9yZGVyLmRlbChbb3JkZXJJRF0pO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19PcG5cIiwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgLy9maWxsIGZpZWxkcyBmcm9tIGN1c3RvbWVyIG9iamVjdFxyXG4gICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19ObVwiLCBjdXN0b21lcltcImZ1bGxOYW1lXCJdKTtcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfUHJcIiwgY3VzdG9tZXJbXCJwcmVmZXJlbmNlc1wiXSk7XHJcbiAgICAgICAgICAvL2ZpbGwgZmllbGRzIGZyb20gY3VzdG9tZXIgYW5kIG9yZGVyIG9iamVjdHNcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfVGVsXCIsIFtvcmRlcltcInRlbGVwaG9uZVwiXVswXSwgLi4uY3VzdG9tZXJbXCJ0ZWxlcGhvbmVzXCJdLmZpbHRlcih0ZWwgPT4gdGVsICE9IG9yZGVyW1widGVsZXBob25lXCJdWzBdKV0pO1xyXG4gICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19TTVwiLCBbb3JkZXJbXCJzb2NpYWxNZWRpYVwiXVswXSwgLi4uY3VzdG9tZXJbXCJzb2NpYWxNZWRpYVwiXS5maWx0ZXIobWVkaWEgPT4gbWVkaWEgIT0gb3JkZXJbXCJzb2NpYWxNZWRpYVwiXVswXSldKTtcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfQWRyXCIsIFtvcmRlcltcImFkcmVzc1wiXVswXSwgLi4uY3VzdG9tZXJbXCJhZHJlc3Nlc1wiXS5maWx0ZXIoYWRyZXNzID0+IGFkcmVzcyAhPSBvcmRlcltcImFkcmVzc1wiXVswXSldKTtcclxuICAgICAgICAgIC8vZmlsbCBmaWVsZHMgZnJvbSBvcmRlciBvYmplY3RcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfSURcIiwgb3JkZXJbXCJpZFwiXSk7XHJcbiAgICAgICAgICBvdXQuaW5zZXJ0RGF0YShcIkFXX09OXCIsIG9yZGVyW1wib3JkZXJOb3Rlc1wiXSk7XHJcbiAgICAgICAgICBvdXQuaW5zZXJ0RGF0YShcIkFXX1N1bVwiLCBvcmRlcltcInN1bW1hcnlcIl0pO1xyXG4gICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19CaWxsXCIsIG9yZGVyW1wiYmlsbGVkXCJdID09IFwidHJ1ZVwiKTtcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfbl90aHNcIiwgb3JkZXJbXCJpc05vdFRoaXNcIl0gPT0gXCJ0cnVlXCIpO1xyXG4gICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19hbl9GTlwiLCBvcmRlcltcImlzTm90VGhpc1wiXSA9PSBcInRydWVcIj9vcmRlcltcImFub3RoZXJGdWxsTmFtZVwiXTpcIlwiKTtcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfYW5fVGVsXCIsIG9yZGVyW1wiaXNOb3RUaGlzXCJdID09IFwidHJ1ZVwiP29yZGVyW1wiYW5vdGhlclRlbGVwaG9uZVwiXTpcIlwiKTtcclxuICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfUFwiLCBvcmRlcltcInBheURhdGVzXCJdLm1hcCgoZCwgaSkgPT4gW29yZGVyW1wicGF5c1wiXVtpXSwgZF0pKTtcclxuICAgICAgICAgIC8vY2xlYXIga2l0c1xyXG4gICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19raXRzXCIsIHt9KTtcclxuXHJcbiAgICAgICAgICBpZihvcmRlcltcImN5Y2xlSURcIl0gPT0gLTEpe1xyXG4gICAgICAgICAgICBkYkN5Y2xlLnNlbGVjdChcIlRSVUVcIiwgW10sIGN5Y2xlcyA9PiB7XHJcbiAgICAgICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19jX2lkXCIsIFtbLTEsIFwiU2VsZWN0IEN5Y2xlXCJdLCAuLi5jeWNsZXMubWFwKGN5Y2xlID0+IFtjeWNsZVtcImlkXCJdLCBjeWNsZVtcIm5hbWVcIl1dKSBdKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9ZWxzZSBkYkN5Y2xlLnNlbGVjdChcIlRSVUVcIiwgW10sIGN5Y2xlcyA9PiB7XHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZEN5Y2xlID0gY3ljbGVzLmZpbmQoY3ljbGUgPT4gY3ljbGUuaWQgPT0gb3JkZXIuY3ljbGVJRCk7XHJcbiAgICAgICAgICAgIHZhciByZXN0Q3ljbGVzID0gY3ljbGVzLmZpbHRlcihjeWNsZSA9PiBjeWNsZS5pZCAhPSBvcmRlci5jeWNsZUlEKTtcclxuICAgICAgICAgICAgb3V0Lmluc2VydERhdGEoXCJBV19jX2lkXCIsIFsgW3NlbGVjdGVkQ3ljbGUuaWQsIHNlbGVjdGVkQ3ljbGUubmFtZV0sIC4uLnJlc3RDeWNsZXMubWFwKGN5Y2xlID0+IFtjeWNsZS5pZCwgY3ljbGUubmFtZV0pIF0pO1xyXG5cclxuICAgICAgICAgICAgZGJLaXQuc2VsZWN0KFwiY3ljbGVJRCA9ID9cIiwgW29yZGVyLmN5Y2xlSURdLCBraXRzRnJvbURCID0+IHtcclxuICAgICAgICAgICAgICAobmV3IFByb2R1Y3RUYWJsZVNRTCgpKS5zZWxlY3QoXCJjeWNsZUlEID0gP1wiLCBbb3JkZXIuY3ljbGVJRF0sIHByb2R1Y3RzID0+IHtcclxuICAgICAgICAgICAgICAgIGtpdHNGcm9tREIuZm9yRWFjaCgoa2l0LCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGxldCBpZE1hcCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICBraXRzRnJvbURCW2ldLnByb2R1Y3RzLmZvckVhY2goKHByLCBpKSA9PiBpZE1hcFtwci5uYW1lXSA9IGkpO1xyXG4gICAgICAgICAgICAgICAgICBraXRzRnJvbURCW2ldLnByb2R1Y3RzID0gcHJvZHVjdHMubWFwKHByID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgaWRNYXBbcHIubmFtZV0gIT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgICBsZXQga1ByID0ga2l0c0Zyb21EQltpXS5wcm9kdWN0c1tpZE1hcFtwci5uYW1lXV07XHJcbiAgICAgICAgICAgICAgICAgICAgICBwci5wcmljZS5zZWxlY3RlZCA9IGtQci5wcmljZS5zZWxlY3RlZDtcclxuICAgICAgICAgICAgICAgICAgICAgIHByLmNvdW50ID0ga1ByLmNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgcHIucHJpY2Uuc2VsZWN0ZWQgPSBwci5wcmljZVtcInAta3RcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgICBwci5jb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHByKSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIG9yZGVyS2l0ID0gb3JkZXIua2l0c1traXQubmFtZV07XHJcbiAgICAgICAgICAgICAgICAgIGlmKCFvcmRlcktpdCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAga2l0c0Zyb21EQltpXS5jb3VudCA9ICh0eXBlb2Ygb3JkZXJLaXQuY291bnQgPT0gXCJudW1iZXJcIik/b3JkZXJLaXQuY291bnQ6MDtcclxuICAgICAgICAgICAgICAgICAga2l0c0Zyb21EQltpXS5wcmljZSA9ICh0eXBlb2Ygb3JkZXJLaXQucHJpY2UgPT0gXCJudW1iZXJcIik/KG9yZGVyS2l0LnByaWNlKTooa2l0c0Zyb21EQltpXS5wcmljZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgbmFtZXMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgb3JkZXJLaXQucHJvZHVjdHMuZm9yRWFjaCgocHIsIGkpID0+IG5hbWVzW3ByLm5hbWVdID0gaSk7XHJcbiAgICAgICAgICAgICAgICAgIGxldCBwY1ByaWNlID0gMDtcclxuICAgICAgICAgICAgICAgICAgbGV0IHBjV2VpZ2h0ID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGtpdC5wcm9kdWN0cy5mb3JFYWNoKChwciwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG5hbWVzW3ByLm5hbWVdICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgcHIuY291bnQgPSBvcmRlcktpdC5wcm9kdWN0c1tuYW1lc1twci5uYW1lXV0uY291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICBwci5wcmljZS5zZWxlY3RlZCA9IG9yZGVyS2l0LnByb2R1Y3RzW25hbWVzW3ByLm5hbWVdXS5wcmljZS5zZWxlY3RlZDtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmKHByLmNvdW50ID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBjUHJpY2UgKz0gcHIuY291bnQqcHIucHJpY2VbcHIucHJpY2Uuc2VsZWN0ZWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwY1dlaWdodCArPSBwci53ZWlnaHQqcHIuY291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICBwci5jb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICBwci5wcmljZS5zZWxlY3RlZCA9IFwicC1rdFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBraXQucHJvZHVjdHNbaV0gPSBPYmplY3QuYXNzaWduKHt9LCBwcik7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAga2l0LnBjUHJpY2UgPSBwY1ByaWNlO1xyXG4gICAgICAgICAgICAgICAgICBraXQucGNXZWlnaHQgPSBwY1dlaWdodDtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coa2l0LCBwY1ByaWNlLCBwY1dlaWdodCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIga2l0c0RhdGEgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBraXRzRnJvbURCLmZvckVhY2goa2l0ID0+IHtcclxuICAgICAgICAgICAgICAgICAga2l0c0RhdGFba2l0Lm5hbWVdID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShraXQpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfa2l0c1wiLCBraXRzRGF0YSk7XHJcbiAgICAgICAgICAgICAgICBvdXQuaW5zZXJ0RGF0YShcIkFXX1N1bVBDXCIsIChraXRzRnJvbURCLmZpbHRlcihraXQgPT4ga2l0LmNvdW50ID4gMCkubWFwKGtpdCA9PiBraXQuY291bnQqKGtpdC5wcmljZT9raXQucHJpY2U6a2l0LnBjUHJpY2UpKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSkgKyBcIiB1YWhcIik7XHJcbiAgICAgICAgICAgICAgICBpZihjYikgY2IoKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkaXNwbGF5S2l0cyhjeWNsZUlEKXtcclxuICAgIHZhciBvdXQgPSBuZXcgQ3VzdG9tZXJQcm9maWxlT3V0cHV0KCk7XHJcbiAgICB2YXIgZGJDeWNsZSA9IG5ldyBDeWNsZVRhYmxlU1FMKCk7XHJcbiAgICB2YXIgZGJLaXQgPSBuZXcgS2l0VGFibGVTUUwoKTtcclxuXHJcblxyXG4gICAgZGJLaXQuc2VsZWN0KFwiY3ljbGVJRCA9ID9cIiwgW2N5Y2xlSURdLCBraXRzID0+IHtcclxuICAgICAgdmFyIGtpdHNEYXRhID0ge307XHJcblxyXG4gICAgICAobmV3IFByb2R1Y3RUYWJsZVNRTCgpKS5zZWxlY3QoXCJjeWNsZUlEID0gP1wiLCBbY3ljbGVJRF0sIHByb2R1Y3RzID0+IHtcclxuICAgICAgICBmb3IodmFyIGsgaW4ga2l0cyl7XHJcbiAgICAgICAgICBsZXQga2l0ID0ga2l0c1trXTtcclxuXHJcbiAgICAgICAgICBsZXQgaWRNYXAgPSB7fTtcclxuICAgICAgICAgIGtpdC5wcm9kdWN0cy5mb3JFYWNoKChwciwgaSkgPT4gaWRNYXBbcHIubmFtZV0gPSBpKTtcclxuICAgICAgICAgIGtpdC5wcm9kdWN0cyA9IHByb2R1Y3RzLm1hcChwciA9PiB7XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZiBpZE1hcFtwci5uYW1lXSAhPSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICAgICAgICBsZXQga1ByID0ga2l0LnByb2R1Y3RzW2lkTWFwW3ByLm5hbWVdXTtcclxuICAgICAgICAgICAgICBwci5wcmljZS5zZWxlY3RlZCA9IGtQci5zZWxlY3RlZDtcclxuICAgICAgICAgICAgICBwci5jb3VudCA9IGtQci5jb3VudDtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgcHIucHJpY2Uuc2VsZWN0ZWQgPSBwci5wcmljZVtcInAta3RcIl07XHJcbiAgICAgICAgICAgICAgcHIuY291bnQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBwcjtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGlmKCFraXRzW2tdLmNvdW50KSBraXRzW2tdLmNvdW50ID0gMDtcclxuICAgICAgICAgIGtpdHNEYXRhW2tpdHNba11bXCJuYW1lXCJdXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoa2l0KSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvdXQuaW5zZXJ0RGF0YShcIkFXX2tpdHNcIiwga2l0c0RhdGEpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlQ3VzdG9tZXIoY3VzdG9tZXJJRCl7XHJcbiAgICB2YXIgZGIgPSBuZXcgQ3VzdG9tZXJUYWJsZVNRTCgpO1xyXG4gICAgdmFyIG91dCA9IG5ldyBDdXN0b21lclByb2ZpbGVPdXRwdXQoKTtcclxuICAgIHZhciBfaW4gPSBuZXcgQ3VzdG9tZXJQcm9maWxlSW5wdXQoKTtcclxuICAgIGlmKF9pbi50YWtlRGF0YShcIldQX0lEXCIpID09IGN1c3RvbWVySUQpIHRoaXMuZmlsbEN1c3RvbWVyV2luKC0xKTtcclxuICAgIG91dC5pbnNlcnREYXRhKFwiV1BfVGJsX0NEXCIsIGN1c3RvbWVySUQpO1xyXG4gICAgZGIuZGVsKFtjdXN0b21lcklEXSk7XHJcbiAgICBjb25zb2xlLmxvZyhjdXN0b21lcklEKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZU9yZGVyKG9yZGVySUQpe1xyXG4gICAgdmFyIGRiID0gbmV3IE9yZGVyVGFibGVTUUwoKTtcclxuICAgIHZhciBvdXQgPSBuZXcgQ3VzdG9tZXJQcm9maWxlT3V0cHV0KCk7XHJcbiAgICBkYi5kZWwoW29yZGVySURdKTtcclxuICAgIG91dC5pbnNlcnREYXRhKFwiV1BfVGJsX09EXCIsIG9yZGVySUQpO1xyXG4gIH1cclxuXHJcblxyXG4gIGdldEN1c3RvbWVyRnJvbVBhZ2UoKXtcclxuICAgIHZhciBpbnAgPSBuZXcgQ3VzdG9tZXJQcm9maWxlSW5wdXQoKTtcclxuICAgIHJldHVybiBuZXcgQ3VzdG9tZXJNb2RlbCh7XHJcbiAgICAgIGlkOiBpbnAudGFrZURhdGEoXCJXUF9JRFwiKSxcclxuICAgICAgZnVsbE5hbWU6IGlucC50YWtlRGF0YShcIldQX05tXCIpLFxyXG4gICAgICB0ZWxlcGhvbmVzOiBpbnAudGFrZURhdGEoXCJXUF9UZWxcIiksXHJcbiAgICAgIGFkcmVzc2VzOiBpbnAudGFrZURhdGEoXCJXUF9BZHJcIiksXHJcbiAgICAgIGVtYWlsOiBpbnAudGFrZURhdGEoXCJXUF9FLW1cIiksXHJcbiAgICAgIG5vdGVzOiBpbnAudGFrZURhdGEoXCJXUF9OdFwiKSxcclxuICAgICAgcHJlZmVyZW5jZXM6IGlucC50YWtlRGF0YShcIldQX1ByXCIpLFxyXG4gICAgICBzb2NpYWxNZWRpYTogaW5wLnRha2VEYXRhKFwiV1BfU01cIiksXHJcbiAgICAgIGFjdGl2aXR5OiBpbnAudGFrZURhdGEoXCJXUF9BY3RcIilcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0T3JkZXJGcm9tUGFnZShhLCByZXR1cm5Pbmx5S2l0cyl7XHJcbiAgICBsZXQgaW5wID0gbmV3IEN1c3RvbWVyUHJvZmlsZUlucHV0KCk7XHJcbiAgICBsZXQgb3JkZXIgPSBuZXcgT3JkZXJNb2RlbCh7XHJcbiAgICAgIGlkOiBpbnAudGFrZURhdGEoXCJBV19JRFwiKSxcclxuICAgICAgY3ljbGVJRDogaW5wLnRha2VEYXRhKFwiQVdfY19pZFwiKSxcclxuICAgICAgdGVsZXBob25lOiBpbnAudGFrZURhdGEoXCJBV19UZWxcIiksXHJcbiAgICAgIHNvY2lhbE1lZGlhOiBpbnAudGFrZURhdGEoXCJBV19TTVwiKSxcclxuICAgICAgYWRyZXNzOiBpbnAudGFrZURhdGEoXCJBV19BZHJcIiksXHJcbiAgICAgIG9yZGVyTm90ZXM6IGlucC50YWtlRGF0YShcIkFXX09OXCIpLFxyXG4gICAgICBzdW1tYXJ5OiBpbnAudGFrZURhdGEoXCJBV19TdW1cIiksXHJcbiAgICAgIGJpbGxlZDogaW5wLnRha2VEYXRhKFwiQVdfQmlsbFwiKSxcclxuICAgICAgaXNOb3RUaGlzOiBpbnAudGFrZURhdGEoXCJBV19uX3Roc1wiKSxcclxuICAgICAgY3VzdG9tZXJJRDogaW5wLnRha2VEYXRhKFwiV1BfSURcIiksXHJcbiAgICAgIGFub3RoZXJGdWxsTmFtZTogaW5wLnRha2VEYXRhKFwiQVdfYW5fRk5cIiksXHJcbiAgICAgIGFub3RoZXJUZWxlcGhvbmU6IGlucC50YWtlRGF0YShcIkFXX2FuX1RlbFwiKSxcclxuICAgICAga2l0czogaW5wLnRha2VEYXRhKFwiQVdfa2l0c1wiKVxyXG4gICAgfSk7XHJcbiAgICBpZihyZXR1cm5Pbmx5S2l0cykgcmV0dXJuIG9yZGVyLmtpdHM7XHJcbiAgICBsZXQgY3VzdG9tZXIgPSB0aGlzLmdldEN1c3RvbWVyRnJvbVBhZ2UoKTtcclxuICAgIGN1c3RvbWVyLnByZWZlcmVuY2VzID0gaW5wLnRha2VEYXRhKFwiQVdfUHJcIik7XHJcbiAgICBpZighY3VzdG9tZXIudGVsZXBob25lcy5maW5kKHQgPT4gdD09b3JkZXIudGVsZXBob25lKSkgY3VzdG9tZXIudGVsZXBob25lcy5wdXNoKG9yZGVyLnRlbGVwaG9uZVswXSk7XHJcbiAgICBpZighY3VzdG9tZXIuYWRyZXNzZXMuZmluZChvID0+IG89PW9yZGVyLmFkcmVzcykpIGN1c3RvbWVyLmFkcmVzc2VzLnB1c2gob3JkZXIuYWRyZXNzWzBdKTtcclxuICAgIGlmKCFjdXN0b21lci5zb2NpYWxNZWRpYS5maW5kKG8gPT4gbz09b3JkZXIuc29jaWFsTWVkaWEpKSBjdXN0b21lci5zb2NpYWxNZWRpYS5wdXNoKG9yZGVyLnNvY2lhbE1lZGlhWzBdKTtcclxuXHJcbiAgICBjb25zdCBwYXlEYXRhID0gaW5wLnRha2VEYXRhKFwiQVdfUFwiKTtcclxuICAgIGxldCBwYXlzID0gcGF5RGF0YS5tYXAoZGF0YSA9PiBkYXRhWzBdKTtcclxuICAgIGxldCBkYXRlcyA9IHBheURhdGEubWFwKGRhdGEgPT4gZGF0YVsxXSk7XHJcblxyXG4gICAgb3JkZXIucGF5cyA9IHBheXM7XHJcbiAgICBvcmRlci5wYXlEYXRlcyA9IGRhdGVzO1xyXG5cclxuICAgIHJldHVybiBbb3JkZXIsIGN1c3RvbWVyXTtcclxuICB9XHJcblxyXG4gIHNhdmVDdXN0b21lcihjdXN0b21lciwgY2Ipe1xyXG4gICAgbGV0IGRiID0gbmV3IEN1c3RvbWVyVGFibGVTUUwoKTtcclxuICAgIGxldCBpZCA9IGN1c3RvbWVyW1wiaWRcIl07XHJcbiAgICBpZihpZD09LTEpIGRlbGV0ZSBjdXN0b21lcltcImlkXCJdO1xyXG4gICAgZGIuc2F2ZShbY3VzdG9tZXJdLCBjdXN0b21lcnMgPT4ge1xyXG4gICAgICBjYihjdXN0b21lcnNbMF0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzYXZlT3JkZXIob3JkZXIsIGNiKXtcclxuICAgIGxldCBkYiA9IG5ldyBPcmRlclRhYmxlU1FMKCk7XHJcbiAgICBsZXQgaWQgPSBvcmRlcltcImlkXCJdO1xyXG4gICAgaWYoaWQ9PS0xKSBkZWxldGUgb3JkZXJbXCJpZFwiXTtcclxuICAgIGRiLnNhdmUoW29yZGVyXSwgb3JkZXJzID0+IHtcclxuICAgICAgY2Iob3JkZXJzWzBdKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkVG9BcnJheShpbnBOYW1lLCBlbXApe1xyXG4gICAgaWYoIWlucE5hbWUpIHJldHVybiBmYWxzZTtcclxuICAgIGxldCBpbnAgPSBuZXcgQ3VzdG9tZXJQcm9maWxlSW5wdXQoKTtcclxuICAgIGxldCBvdXQgPSBuZXcgQ3VzdG9tZXJQcm9maWxlT3V0cHV0KCk7XHJcbiAgICBsZXQgdmFscyA9IGlucC50YWtlRGF0YShpbnBOYW1lKTtcclxuXHJcbiAgICB2YWxzW3ZhbHMubGVuZ3RoXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsc1swXSkpO1xyXG4gICAgdmFsc1swXSA9IGVtcDtcclxuXHJcbiAgICBvdXQuaW5zZXJ0RGF0YShpbnBOYW1lLCB2YWxzKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdFRhYmxlKHNlYXJjaCl7XHJcbiAgICBBcnJheS5mcm9tKChuZXcgQ3VzdG9tZXJQcm9maWxlSW5wdXQoKSkudGFrZURhdGEoXCJUYmxfcm93c1wiKSkuZm9yRWFjaCh0ciA9PiB7XHJcbiAgICAgIHZhciBoYXNTZWFyY2hlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgQXJyYXkuZnJvbSh0ci5xdWVyeVNlbGVjdG9yQWxsKFwidGRcIikpLmZvckVhY2godGQgPT4ge1xyXG4gICAgICAgIGlmKHRkLmlubmVySFRNTC5zZWFyY2goc2VhcmNoKSA+IC0xKSBoYXNTZWFyY2hlZCA9IHRydWU7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYoaGFzU2VhcmNoZWQpIHRyLnN0eWxlLmRpc3BsYXkgPSBcInRhYmxlLXJvd1wiO1xyXG4gICAgICBlbHNlIHRyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIHVwZGF0ZU9yZGVyRm9ybShraXRzKXtcclxuICAgIGxldCBvdXQgPSBuZXcgQ3VzdG9tZXJQcm9maWxlT3V0cHV0KCk7XHJcbiAgICBmb3IodmFyIGsgaW4ga2l0cykga2l0c1trXS5uYW1lID0gaztcclxuICAgIGxldCBkYXRhID0gT2JqZWN0LnZhbHVlcyhraXRzKS5maWx0ZXIoa2l0ID0+IGtpdC5jb3VudCA+IDApLm1hcChraXQgPT4gW2tpdC5jb3VudCooa2l0LnByaWNlP2tpdC5wcmljZTpraXQucGNQcmljZSksIGtpdC5uYW1lXSk7XHJcblxyXG4gICAgb3V0Lmluc2VydERhdGEoXCJBV19TdW1QQ1wiLCAoZGF0YS5tYXAoZSA9PiBlWzBdKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSkgKyBcIiB1YWhcIik7XHJcbiAgICBkYXRhLmZvckVhY2goZCA9PiB7XHJcbiAgICAgIG91dC5pbnNlcnREYXRhKFwiQVdfS3RQQ1wiLCBba2l0c1tkWzFdXS5wY1ByaWNlLCBraXRzW2RbMV1dLnBjV2VpZ2h0LCBkWzFdXSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
